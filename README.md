# **Medical-Chat-Bot**
&emsp;&emsp;设计和实现一个网页系统架构，要求该架构能够调用并集成已经训练好的医学大语言模型，以实现用户与系统之间的交互。

## **流程：**

### 一、系统配置

&emsp;&emsp;首先需要安装如下依赖以启动医疗问答大模型：datasets==2.14.5, gradio==3.38.0, peft==0.9.0, sentencepiece==0.1.99, torch==2.1.2+cu121, transformers==4.38.1, trl==0.7.11, flask。  
&emsp;&emsp;其次，在终端中输入命令“python gradio.py --model_name_or_path  ./medical_model/ --template chatglm3”或者“python flask.py --model_name_or_path  ./medical_model/ --template chatglm3”。运行成功后会自动弹出端口，点击网址即可进入网络架构界面。

### 二、实现网页系统架构

#### 1.用gradio实现网页系统架构

&emsp;&emsp;在构建用户与大语言模型交互的网页系统时，考虑易用性、开发效率、集成能力及用户交互友好性等
多方面因素，我选择Gradio 作为实现工具，因为它高效，易于上手，支持多种输入输出类型，并具备简洁美观的界面。
    通过定义 chat_with_model 函数来与用户进行交互，通过 ChatModel 类来获取模型的响应。同时提供了退出和清除历史记录的功能。

#### 2.用flask实现网页系统架构

&emsp;&emsp;采用Gradio框架初步实现的网页交互系统虽然能够有效地实现用户与医疗问答机器人的即时互动，确保了机器人在用户触发“clear”操作前能基于历史对话上下文连续回答关于同一主题的多轮问题，但其页面设计受限于Gradio的内置模板，仅支持展示当前轮次的问答内容，缺乏对历史对话记录的可视化支持。   
&emsp;&emsp;为了提升用户体验，增强系统的灵活性和可扩展性，转而使用HTML进行自定义网页界面的开发。借助HTML、CSS以及JavaScript构建出更加丰富、直观的界面。鉴于后续的开发工作将主要在CPU环境下进行，且考虑到轻量级、易于部署和维护的需求，决定选择Flask作为后端框架。

### 三、系统评测

&emsp;&emsp;为了评估构建的网页系统架构的性能，将采用以下两个数据集进行综合评测。首先，从世界卫生组织制定的人类常见病中随机选取103种病症，并将这些病症名称以每行一个的格式保存在文档"questions1.txt"中。  
&emsp;&emsp;其次，下载丁香医生在2015至2019年间公布的中国临床常见109种疾病的名称、病历和快速诊断要点文档，从中随机选取100种病症，并将相关信息以每行一种病症的格式整理记录在文档"questions2.txt"中。

## 结果

&emsp;&emsp;对question1.txt中的103个问题，系统响应的平均时间为2.7689秒。  
&emsp;&emsp;对question2.txt中的100个问题，系统响应的平均时间为1.1422秒。

&emsp;&emsp;在对"response1.txt"文件进行分析时，发现该系统对前8个问题进行回复时，不仅提供了对病症的概括性描述，还详细列举了所有可能的症状。对于接下来的63个病症，系统用一段话简单地介绍了病因和典型的特征。然而，对于剩下的32个问题，系统未能提供准确的回答，仅回应了一句“如果出现以上症状，建议及时就医。”并记录了响应时间。  
&emsp;&emsp;查阅相关资料可知，在已回答的71个问题中，有68个问题的回答基本正确，有3个问题的回答偏离了疾病特征的重点或对病因的描述错误。因此，对于"questions1.txt"，系统的响应率为69%，在已回答的问题中正确率为96%，在所有问题中的正确率为66%。
  
&emsp;&emsp;分析"response2.txt"文件，发现系统仅对前54个症状进行了具体疾病的判断，而对后46个症状则没有提供答案，仅记录了响应时间。在前54个已回答的问题中，有41个回答正确，13个回答错误，错误主要源于系统无法对症状非常相似的几个病症做出精准的判断和患者描述症状过于口语化时系统无法做出准确的诊断。  

&emsp;&emsp;因此，针对"questions2.txt"，系统的响应率为54%，在已回答的问题中正确率为76%，在所有问题中的正确率为41%。

&emsp;&emsp;综合分析结果可知，相较于根据用户描述的症状判断用户得了什么病，该系统更擅长已知用户得了什么病，分析都有什么典型症状让用户自查并给出用户建议。同时，根据系统的响应结果我们也可知，当用户对症状的描述过于口语化时，系统可能会混淆不同的病症，导致错误的判断
